---
- name: Force stop mongo (forking w/o pidfile means systemd cannot restart mongod safely)
  block:
    - name: Force stop mongod
      shell: pkill -e mongod
      register: _pkill_task
    - debug:
        var: _pkill_task

#- name: Restart mongod in docker
#  block:
#    - name: Restart mongod in docker
#      service:
#        name: mongod
#        state: started
#      register: _service_task
#  recover:
#    - name: Force stop mongod (try again)
#      shell: pkill -e mongod
#      register: _pkill_task
#    - debug:
#        var: _pkill_task
#    - name: Restart mongod in docker (try again)
#      service:
#        name: mongod
#        state: started
#      until: _service_task is succeeded
#      retries: 3
#      delay: 5
#  always:
#    - name: Inspect mongod service
#      command: systemctl status mongod
#      register: _status_task
#    - debug:
#        var: _status_task

#- name: Wait for mongod to become active
#  wait_for:
#    port: "{{ mongod_port }}"
#    delay: 10
